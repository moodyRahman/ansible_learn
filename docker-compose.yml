services:

  inventory-api:
    image: moody/inventory_server:latest
    container_name: cmoon_inventory
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

  ansible:
    image: moody/cmoon:latest
    container_name: cmoon
    restart: unless-stopped
    environment:
      - PUBLIC_KEY=${PUBLIC_KEY}
      - USER_NAME=${USER_NAME}
    volumes:
      - ./inventory:/ansible/inventory/
      - ./roles:/ansible/roles/
      - ./playbook:/ansible/playbook/
      - ./keys:/ansible/keys
      - ./ansible.cfg:/ansible/ansible.cfg

  shigechi-1: &common
    image: moody/managed_server:latest
    container_name: shigechi-1
    restart: unless-stopped
    env_file: ".env"
    environment:
      - PUBLIC_KEY=${PUBLIC_KEY}
      - USER_NAME=${USER_NAME}
      - PUID=1000
      - PGID=1000
      - TZ=Etc/UTC
    volumes:
      - ./sshd_config:/config/sshd/sshd_config
    hostname: shigechi-1


  shigechi-2: 
    <<: *common
    container_name: shigechi-2
    hostname: shigechi-2


  shigechi-3: 
    <<: *common
    container_name: shigechi-3
    hostname: shigechi-3

  shigechi-4: 
    <<: *common
    container_name: shigechi-4
    hostname: shigechi-4